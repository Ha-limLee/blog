---
title: Branded Type in TS
date: '2024-12-09'
tags: ['typescript']
draft: false
summary: Branded typeì„ ì´ìš©í•´ ëŸ°íƒ€ì„ ì˜¤ë¥˜ ë°©ì§€
images: []
layout: PostSimple
authors: ['default']
---

# Overview

<TOCInline toc={props.toc} exclude="Overview" toHeading={2} />

âš ï¸ TS v5.7.2 ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë¨

# ì‹ ì… ê°œë°œìì˜ ì‹¤ìˆ˜

ë‹¤ìŒê³¼ ê°™ì€ ìš”êµ¬ì‚¬í•­ì´ ìˆë‹¤ê³  í•˜ì.

**ìš”êµ¬ì‚¬í•­**

- canvasì— ìƒˆë¡œìš´ ë„êµ¬ pencilì„ ì¶”ê°€
- ìœ ì €ëŠ” pencilì„ ì¨ì„œ canvasì— ê·¸ë¦¼ì„ ê·¸ë¦´ ìˆ˜ ìˆë‹¤
- (ì œì•½) pointì˜ x, y ê°’ì€ ì •ìˆ˜ì—¬ì•¼ í•œë‹¤

ì½”ë“œë¡œëŠ” ì´ë ‡ê²Œ ëª¨ë¸ë§ í•  ê²ƒì´ë‹¤.

```ts
type Point = readonly [number, number];

function toInteger(p: Point): Point {
  return [Math.round(p[0]), Math.round(p[1])] as const;
}

type State = {
  points: Point[];
};

type Actions = {
  type: 'add';
  payload: Point;
};

function reducer(state: State, action: Actions): State {
  switch (action.type) {
    case 'add':
      return {
        ...state,
        points: state.points.concat(toInteger(action.payload)),
      };
    default:
      return action.type satisfies never;
  }
}
```

...

ì´ ì½”ë“œë¥¼ ì‘ì„±í•œ í›„ ëª‡ ë‹¬ì´ ì§€ë‚˜ ì‹ ì… ê°œë°œìê°€ ë“¤ì–´ì™”ë‹¤. ì‹ ì…ì€ ì²« ì‘ì—…ìœ¼ë¡œ canvasì˜ ìƒˆ ìš”êµ¬ì‚¬í•­ì„ êµ¬í˜„í•˜ê²Œ ëë‹¤.

**ìš”êµ¬ì‚¬í•­**

- `shift`ë¥¼ ëˆ„ë¥¸ ì±„ pencilë¡œ ê·¸ë¦¬ë©´ ì§ì„ ì´ ëœë‹¤.

ì‹ ì…ì€ ì´ë ‡ê²Œ êµ¬í˜„í–ˆë‹¤.

```diff
 type Actions =
   | {
       type: "add";
       payload: Point;
     }
+  | {
+      type: "line";
+      payload: Point;
+    };

 function reducer(state: State, action: Actions): State {
   switch (action.type) {
     case "add":
       return {
         ...state,
         points: state.points.concat(toInteger(action.payload)),
       };
+    case "line":
+      return {
+        ...state,
+        points: [state.points[0], action.payload].filter((p) => p != null),
+      };
     default:
       return action satisfies never;
   }
 }

```

íƒ€ì… ì˜¤ë¥˜ê°€ ì—†ìœ¼ë‹ˆ ì‹ ì…ì€ ì‘ì—…ì„ ë§ˆì³¤ë‹¤ê³  ë³´ê³ í–ˆê³  ì´ ì½”ë“œëŠ” ê³ ìŠ¤ë€íˆ production buildì— ì‹¤ë ¸ë‹¤.

ì•ˆíƒ€ê¹ê²Œë„ ì‹ ì…ì˜ ìƒê°ê³¼ëŠ” ë‹¬ë¦¬ ì„œë¹„ìŠ¤ì—ì„œ ê³§ë°”ë¡œ ë²„ê·¸ê°€ ì œë³´ëë‹¤. ì„œë²„ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²ƒì´ë‹¤!

ë””ë²„ê¹…ì„ í•´ë³´ë‹ˆ ì›ì¸ì€ ìƒˆë¡œ ì¶”ê°€í•œ `line` actionì— ìˆì—ˆë‹¤. í”„ë¡ íŠ¸ì—ì„œ ì„œë²„ë¡œ x, y ê°’ì´ ì†Œìˆ˜ì¸ pointë¥¼ ë³´ë‚¸ ê²ƒì´ë‹¤.

```ts {5,5}
case "line":
  return {
    ...state,
    // ğŸ’¥ x, yê°€ ì†Œìˆ˜ì¸ pointê°€ ì €ì¥ë¨
    points: [state.points[0], action.payload].filter((p) => p != null),
  };
```

ì‹ ì…ì€ ì„œë‘˜ëŸ¬ `toInteger`ë¥¼ ì ìš©í•´ ë¬¸ì œë¥¼ í•´ê²°í–ˆë‹¤.

```diff
 case "line":
   return {
     ...state,
     points: [state.points[0], action.payload]
       .filter((p) => p != null)
+      .map(toInteger),
   };
```

í˜ë“  í•˜ë£¨ì˜€ë‹¤. ì²« ì‘ì—…ì—ì„œ ì‹¤ìˆ˜í•œ ì‹ ì… ê°œë°œìëŠ” ì§‘ìœ¼ë¡œ ëŒì•„ê°€ë©° ê³ ë¯¼í–ˆë‹¤.

> ì´ëŸ° ì‹¤ìˆ˜ë¥¼ ë¯¸ë¦¬ ë°©ì§€í•  ë°©ë²•ì€ ì—†ì„ê¹Œ?

# ì •ìˆ˜ íƒ€ì…ì´ ìˆì—ˆë‹¤ë©´

ì´ëŸ° ë¬¸ì œì˜ ì›ì¸ì€ JavaScript(ES2020 ì´ì „)ì—ì„œ ì •ìˆ˜ì™€ ì†Œìˆ˜ë¥¼ êµ¬ë¶„í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.[^1] ë§Œì•½ JSì— ì •ìˆ˜ íƒ€ì…ì´ ìˆì—ˆë‹¤ë©´ TSë„ ê·¸ë¬ì„ ê²ƒì´ê³  `Point`ë¥¼ ì´ë ‡ê²Œ ì •ì˜í•  ìˆ˜ ìˆì—ˆì„ ê²ƒì´ë‹¤.

```ts
type Point = readonly [integer, integer];
```

ê·¸ë ‡ê²Œ í–ˆë‹¤ë©´ `number`ë¥¼ ì €ì¥í•˜ë ¤ê³  í•  ë•Œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ê²ƒì´ê³  ì„œë¹„ìŠ¤ì—ì„œ ë²„ê·¸ê°€ ë°œê²¬ë˜ëŠ” ì¼ì€ ì—†ì—ˆì„ ê²ƒì´ë‹¤.

```ts {7,7}
function DrawingBoard(): React.JSX.Element {
  const [state, dispatch] = useBoardState();
  const [point, setPoint] = useState([0, 0] as const);

  const onMouseMove = () => {
    // ğŸ’¥ TypeError: Type 'number' is not assignable to type 'integer'.
    dispatch({ type: 'line', payload: point });
  };

  return (
    // ...
  );
}
```

ê·¸ëŸ¬ë‚˜ í˜„ì¬ TSì—ì„œëŠ” ì´ë ‡ê²Œ í•  ìˆ˜ ì—†ë‹¤. `Branded type`ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í•œ.

# Branded Type

ì •ìˆ˜ íƒ€ì…ì´ ì—†ë‹¤ë©´ `number` íƒ€ì…ì„ ì´ìš©í•´ ìƒˆë¡œìš´ íƒ€ì…ì„ ì •ì˜í•˜ë©´ ë  ì¼ì´ë‹¤. ê·¸ëŸ¬ë‚˜ ê·¸ëƒ¥ ì´ë¦„ë§Œ ë‹¬ë¼ì„  ì•ˆ ëœë‹¤. TS íƒ€ì…ì€ structural type systemì´ê¸° ë•Œë¬¸ì— ì´ë¦„ì´ ë‹¬ë¼ë„ êµ¬ì¡°ê°€ ê°™ìœ¼ë©´ ê°™ì€ íƒ€ì…ìœ¼ë¡œ ì·¨ê¸‰í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

```ts
type Integer = number;

declare const num: number;

// ì—¬ê¸°ì„œ íƒ€ì… ì˜¤ë¥˜ë¥¼ ë‚´ê³  ì‹¶ë‹¤!
// ê·¸ëŸ¬ë‚˜ ì§€ê¸ˆì€ ì˜¤ë¥˜ê°€ ì•ˆ ë‚œë‹¤. Integerì™€ numberëŠ” êµ¬ì¡°ê°€ ê°™ê¸° ë•Œë¬¸ì´ë‹¤.
const int: Integer = num;
```

ê·¸ëŸ¼ ìƒˆë¡œìš´ ì†ì„±ì„ ì¶”ê°€í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ?

```diff
-type Integer = number;
+type Integer = number & { __tag: 'Integer' };
```

```ts
// ğŸ’¥ TypeError: Type 'number' is not assignable to type 'Integer'.
const int: Integer = num;
```

ì´ì œ íƒ€ì… ì˜¤ë¥˜ê°€ ë‚œë‹¤! ì´ë ‡ê²Œ ìƒˆë¡œìš´ íƒ€ì…ì„ ì •ì˜í•˜ëŠ” ë°©ì‹ì„ `Branding`, `Branding`ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ íƒ€ì…ì„ `Branded type`ì´ë¼ê³  í•œë‹¤.

# ì‚¬ìƒ

íƒ€ì…ì„ ë§Œë“¤ì—ˆìœ¼ë‹ˆ `number`ë¥¼ `Integer`ë¡œ ì‚¬ìƒ(map)í•˜ëŠ” í•¨ìˆ˜ë¥¼ í•˜ë‚˜ ë§Œë“¤ì.

```ts
function from(num: number): Integer {
  return Math.round(num) as Integer;
}
```

ì‚¬ìƒ í•¨ìˆ˜ëŠ” ë‘ ê°€ì§€ ì—­í• ì„ í•œë‹¤.

1. branded typeì´ ë¬´ì–¼ ëœ»í•˜ëŠ”ì§€ ì •ì˜

   `Integer` ìì²´ëŠ” ì–´ë–¤ ì˜ë¯¸ë„ ì—†ëŠ” ì´ë¦„ì— ë¶ˆê³¼í•˜ë‹¤. ì—¬ê¸°ì— 'ì •ìˆ˜'ë¼ëŠ” ì˜ë¯¸ë¥¼ ë¶€ì—¬í•˜ë ¤ë©´ `Integer` íƒ€ì…ìœ¼ë¡œ ì‚¬ìƒí•˜ëŠ” í•¨ìˆ˜ê°€ ìˆì–´ì•¼ í•˜ë©°, ê·¸ í•¨ìˆ˜ê°€ ë°›ì€ ê°’ì„ ì •ìˆ˜ë¡œ ë°”ê¿”ì•¼ í•œë‹¤.

2. íƒ€ì… ì•ˆì „í•˜ì§€ ì•Šì€ ì˜ì—­ì„ ìµœì†Œí™”

   ì¼ë°˜ì ìœ¼ë¡œ branded typeì„ ì“¸ ë•ŒëŠ” íƒ€ì… ë‹¨ì–¸ì„ í•œë‹¤.[^2] ë§Œì•½ ì‚¬ìƒ í•¨ìˆ˜ê°€ ì—†ìœ¼ë©´ ì—¬ê¸°ì €ê¸°ì—ì„œ íƒ€ì… ë‹¨ì–¸ì„ í•˜ê²Œ ë˜ê¸° ë•Œë¬¸ì— íƒ€ì… ì•ˆì „í•˜ì§€ ì•Šì€ ì˜ì—­ì´ ì»¤ì§„ë‹¤. ë°˜ë©´ ì‚¬ìƒ í•¨ìˆ˜ê°€ ìˆìœ¼ë©´, íƒ€ì… ë‹¨ì–¸ì´ ì‚¬ìƒ í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ í•œ ë²ˆë§Œ ì¼ì–´ë‚˜ê¸° ë•Œë¬¸ì— íƒ€ì… ì•ˆì „í•˜ì§€ ì•Šì€ ì˜ì—­ì„ í•œ ê³³ìœ¼ë¡œ ì¢í ìˆ˜ ìˆë‹¤.

# tagê°€ ê²¹ì¹˜ë©´ ì–´ì©Œì£ ?

`Integer`ì™€ ì „í˜€ ë‹¤ë¥¸ íƒ€ì…ì´ ê°™ì€ `__tag`ë¥¼ ê°–ê³  ìˆë‹¤ë©´ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

```ts {2,2}
// ì‹¤ìˆ˜ë¡œ Integerì™€ ê°™ì€ tagë¥¼ ì‚¬ìš©
type Float = number & { __tag: 'Integer' };

declare const float: Float;

// Integerì™€ Floatì€ ì´ë¦„ë§Œ ë‹¤ë¥¼ ë¿ ê°™ì€ íƒ€ì…ì´ë¯€ë¡œ íƒ€ì… ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ
const int: Integer = float;
```

ì´ëŸ° ì‹¤ìˆ˜ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œëŠ” Symbolì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```diff
+const integerSymbol = Symbol('Integer');

-type Integer = number & { __tag: 'Integer' };
+type Integer = number & { [integerSymbol]: unknown };
```

`Symbol()`ì€ í•­ìƒ ë‹¤ë¥¸ ê°’ì„ ë°˜í™˜í•˜ê¸° ë•Œë¬¸ì— ì¤‘ë³µ key ê±±ì •ì„ ì•ˆ í•´ë„ ëœë‹¤.

# ì‹œê°„ì„ ë˜ëŒë ¤ì„œ

ì‹ ì… ê°œë°œìê°€ ì‹¤ìˆ˜ë¥¼ í•˜ì§€ ì•Šë„ë¡ í•´ë³´ì.

```ts:Integer.ts
const integerSymbol = Symbol('Integer');
type Integer = number & { [integerSymbol]: unknown };

function from(num: number): Integer {
  return Math.round(num) as Integer;
}

// Integerë¥¼ íƒ€ì…ì´ì ëª¨ë“ˆë¡œ ì·¨ê¸‰
const Integer = Object.assign({}, { from });
export default Integer;
```

```ts:reducer.ts
import Integer from './Integer';

type Point = readonly [Integer, Integer];

type State = {
  points: Point[];
};

type Actions =
  | {
      type: 'add';
      payload: Point;
    }
  | {
      type: 'line';
      payload: Point;
    };

export default function reducer(state: State, action: Actions): State {
  switch (action.type) {
    case 'add':
      return { ...state, points: state.points.concat(action.payload) };
    case 'line':
      return { ...state, points: [state.points[0], action.payload].filter((p) => p != null) };
    default:
      return action satisfies never;
  }
}
```

```tsx:Canvas.tsx
import * as React from 'react';
import reducer from './reducer';

function Canvas() {
  const [state, dispatch] = React.useReducer(reducer, { points: [] });
  const [newPoint, setNewPoint] = React.useState([0, 0] as const);

  const onMouseMove = () => {
    // ğŸ’¥ TypeError: Type 'number' is not assignable to type 'Integer'.
    dispatch({ type: 'line', payload: newPoint });
  };

  return <div>{/* ... */}</div>;
}
```

`number`ë¥¼ ì €ì¥í•˜ëŠ” ì‹¤ìˆ˜ë¥¼ TSê°€ ë¯¸ë¦¬ ì•Œë ¤ì¤€ë‹¤! ê·¸ëŸ¬ë¯€ë¡œ ì‹ ì…ì€ ì„œë¹„ìŠ¤ì— ì˜ëª»ëœ ì½”ë“œê°€ ì ìš©ë˜ê¸° ì „ì— ì´ë ‡ê²Œ ê³ ì¹  ê²ƒì´ë‹¤.

```diff
 import reducer from './reducer';
+import Integer from "./Integer";

 function Canvas() {

   const onMouseMove = () => {
-    dispatch({ type: 'line', payload: newPoint });
+    dispatch({
+      type: "line",
+      payload: [Integer.from(newPoint[0]), Integer.from(newPoint[1])],
+    });
   };

   return <div>{/* ... */}</div>;
 }
```

ì‹ ì… ê°œë°œìëŠ” ì²« ì—…ë¬´ë¥¼ ë¬´ì‚¬íˆ ë§ˆì¹˜ê³  í™€ê°€ë¶„í•œ ë§ˆìŒìœ¼ë¡œ í‡´ê·¼í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤!

# ê²°ë¡ 

Branded typeì„ ì´ìš©í•˜ë©´ ì´ì™€ ê°™ì´ TSë¥¼ ë” ì—„ê²©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ë¬¼ë¡  ì¥ì ë§Œ ìˆëŠ” ê±´ ì•„ë‹ˆë‹¤. ì‚¬ìƒ í•¨ìˆ˜ì—ì„œ íƒ€ì… ë‹¨ì–¸ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— í•¨ìˆ˜ì˜ ë¡œì§ì´ íƒ€ì… ì•ˆì „í•˜ë‹¤ëŠ” ê±¸ ê°œë°œìê°€ ë³´ì¥í•´ì•¼ í•œë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ë¡œì§ì´ ë³µì¡í•´ì§„ë‹¤ë©´ ì‚¬ìƒ í•¨ìˆ˜ì— ëŒ€í•œ ì—„ê²©í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê²Œ ì¢‹ë‹¤.

[^1]: ES2020 ì´í›„ì—” `BigInt`ê°€ ì¶”ê°€ë¼ì„œ ì •ìˆ˜ì™€ ì†Œìˆ˜ë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ [BigInt ë„ì… ì˜ë„](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt)ë¥¼ ìƒê°í•´ë³´ë©´ ë‹¨ìˆœíˆ ì •ìˆ˜ë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•´ `BigInt`ë¥¼ ì“°ëŠ” ê±´ ì¢‹ì§€ ì•Šë‹¤.
[^2]: íƒ€ì… ë‹¨ì–¸ì„ í•˜ì§€ ì•Šê³  ìƒˆë¡­ê²Œ ì¶”ê°€í•œ ì†ì„±(Integerì˜ ê²½ìš° `__tag`)ì„ ë„£ì–´ì¤„ ìˆ˜ë„ ìˆëŠ”ë°, ê·¸ëŸ¬ë©´ ë¶ˆí•„ìš”í•œ ê°’ì´ ëŸ°íƒ€ì„ì— ì¶”ê°€ë˜ê¸° ë•Œë¬¸ì— íƒ€ì… ë‹¨ì–¸ì„ í•˜ëŠ” ìª½ì„ ì„ í˜¸í•œë‹¤.
